// Prisma schema for supplier sync service

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Supplier {
  id        String    @id @default(cuid())
  name      String    @unique
  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Product {
  id          String   @id @default(cuid())
  supplierId  String
  supplier    Supplier @relation(fields: [supplierId], references: [id])

  styleId     String
  name        String
  brand       String
  category    String
  material    String?
  imageUrls   String[]
  tags        String[]
  sizes       String[]
  colors      Json     // âœ… stores full color objects
  description String?

  variants    ProductVariant[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([supplierId, styleId], name: "supplierId_styleId")
}

model ProductVariant {
  id               String   @id @default(cuid())
  productId        String
  product          Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  sku              String   @unique // Internal SKU
  size             String?
  color            String?
  colorCode        String?  // Hex color for UI
  style            String?  // "Crew Neck", "V-Neck", etc.

  price            Float
  wholesaleCost    Float

  // Inventory tracking
  inventoryQty     Int      @default(0)
  inventoryStatus  String   @default("out_of_stock") // in_stock, low_stock, out_of_stock
  lastSync         DateTime @default(now())

  // Specifications
  weight           Float?
  dimensions       String?
  materialInfo     String?

  images           String[]
  isActive         Boolean  @default(true)

  supplierMappings SupplierSKU[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([productId])
  @@index([sku])
  @@index([size])
  @@index([color])
}

model SupplierSKU {
  id              String         @id @default(cuid())
  variantId       String
  variant         ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  supplierId      String
  supplierName    String
  supplierSKU     String
  supplierPrice   Float
  isPrimary       Boolean        @default(false)  // Preferred supplier
  leadTimeDays    Int            @default(0)      // Lead time in days
  moq             Int            @default(1)      // Minimum order quantity
  inStock         Boolean        @default(true)
  lastUpdated     DateTime       @default(now())

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@unique([variantId, supplierId, supplierSKU])
  @@index([variantId])
  @@index([supplierSKU])
}